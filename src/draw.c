#include "draw.h"

static uint8_t charMap_ascii[256][12]={
{0,0,0,0,0,0,0,0,0,0,0,0},  /*  0 */
{0,126,129,165,129,129,189,153,129,126,0,0},  /*  1 */
{0,126,255,219,255,255,195,231,255,126,0,0},  /*  2 */
{0,0,108,238,254,254,254,124,56,16,0,0},  /*  3 */
{0,0,16,56,124,254,124,56,16,0,0,0},  /*  4 */
{0,0,16,56,16,108,238,108,16,56,0,0},  /*  5 */
{0,16,56,124,124,254,254,108,16,56,0,0},  /*  6 */
{0,0,0,0,24,60,60,24,0,0,0,0},  /*  7 */
{255,255,255,255,231,195,195,231,255,255,255,255},  /*  8 */
{0,0,0,24,60,102,102,60,24,0,0,0},  /*  9 */
{255,255,255,231,195,153,153,195,231,255,255,255},  /*  10 */
{0,30,14,30,54,120,204,204,204,120,0,0},  /*  11 */
{0,60,102,102,102,60,24,126,24,24,0,0},  /*  12 */
{0,30,26,30,24,24,24,120,248,112,0,0},  /*  13 */
{62,54,62,54,54,118,246,102,14,30,12,0},  /*  14 */
{24,219,126,60,102,102,60,126,219,24,0,0},  /*  15 */
{0,128,224,240,252,254,252,240,224,128,0,0},  /*  16 */
{0,2,14,62,126,254,126,62,14,2,0,0},  /*  17 */
{0,24,60,126,24,24,24,126,60,24,0,0},  /*  18 */
{0,102,102,102,102,102,102,0,102,102,0,0},  /*  19 */
{0,127,219,219,219,123,27,27,27,27,0,0},  /*  20 */
{124,198,198,96,124,246,222,124,12,198,198,124},  /*  21 */
{0,0,0,0,0,0,0,254,254,254,0,0},  /*  22 */
{0,24,60,126,24,24,126,60,24,126,0,0},  /*  23 */
{0,24,60,126,24,24,24,24,24,24,0,0},  /*  24 */
{0,24,24,24,24,24,24,126,60,24,0,0},  /*  25 */
{0,0,0,12,14,255,14,12,0,0,0,0},  /*  26 */
{0,0,0,48,112,254,112,48,0,0,0,0},  /*  27 */
{0,0,0,0,192,192,192,254,0,0,0,0},  /*  28 */
{0,0,0,36,102,255,102,36,0,0,0,0},  /*  29 */
{0,16,56,56,56,124,124,254,254,0,0,0},  /*  30 */
{0,254,254,124,124,124,56,56,16,0,0,0},  /*  31 */
{0,0,0,0,0,0,0,0,0,0,0,0},  /*  ' ' 32 */
{0,24,60,60,60,24,24,0,24,24,0,0},  /*  '!' 33 */
{54,54,54,20,0,0,0,0,0,0,0,0},  /*  '"' 34 */
{0,108,108,108,254,108,108,254,108,108,0,0},  /*  '#' 35 */
{24,24,124,198,192,120,60,6,198,124,24,24},  /*  '$' 36 */
{0,0,0,98,102,12,24,48,102,198,0,0},  /*  '%' 37 */
{0,56,108,56,56,118,246,206,204,118,0,0},  /*  '&' 38 */
{12,12,12,24,0,0,0,0,0,0,0,0},  /*  ''' 39 */
{0,12,24,48,48,48,48,48,24,12,0,0},  /*  '(' 40 */
{0,48,24,12,12,12,12,12,24,48,0,0},  /*  ')' 41 */
{0,0,0,108,56,254,56,108,0,0,0,0},  /*  '*' 42 */
{0,0,0,24,24,126,24,24,0,0,0,0},  /*  '+' 43 */
{0,0,0,0,0,0,0,12,12,12,24,0},  /*  ',' 44 */
{0,0,0,0,0,254,0,0,0,0,0,0},  /*  '-' 45 */
{0,0,0,0,0,0,0,0,24,24,0,0},  /*  '.' 46 */
{0,0,2,6,12,24,48,96,192,128,0,0},  /*  '/' 47 */
{0,124,198,206,222,246,230,198,198,124,0,0},  /*  '0' 48 */
{0,24,120,24,24,24,24,24,24,126,0,0},  /*  '1' 49 */
{0,124,198,198,12,24,48,96,198,254,0,0},  /*  '2' 50 */
{0,124,198,6,6,60,6,6,198,124,0,0},  /*  '3' 51 */
{0,12,28,60,108,204,254,12,12,12,0,0},  /*  '4' 52 */
{0,254,192,192,192,252,6,6,198,124,0,0},  /*  '5' 53 */
{0,124,198,192,192,252,198,198,198,124,0,0},  /*  '6' 54 */
{0,254,198,12,24,48,48,48,48,48,0,0},  /*  '7' 55 */
{0,124,198,198,198,124,198,198,198,124,0,0},  /*  '8' 56 */
{0,124,198,198,198,126,6,6,198,124,0,0},  /*  '9' 57 */
{0,0,0,12,12,0,0,12,12,0,0,0},  /*  ':' 58 */
{0,0,0,12,12,0,0,12,12,12,24,0},  /*  ';' 59 */
{0,12,24,48,96,192,96,48,24,12,0,0},  /*  '<' 60 */
{0,0,0,0,254,0,254,0,0,0,0,0},  /*  '=' 61 */
{0,96,48,24,12,6,12,24,48,96,0,0},  /*  '>' 62 */
{0,124,198,198,12,24,24,0,24,24,0,0},  /*  '?' 63 */
{0,124,198,198,222,222,222,220,192,126,0,0},  /*  '@' 64 */
{0,56,108,198,198,198,254,198,198,198,0,0},  /*  'A' 65 */
{0,252,102,102,102,124,102,102,102,252,0,0},  /*  'B' 66 */
{0,60,102,192,192,192,192,192,102,60,0,0},  /*  'C' 67 */
{0,248,108,102,102,102,102,102,108,248,0,0},  /*  'D' 68 */
{0,254,102,96,96,124,96,96,102,254,0,0},  /*  'E' 69 */
{0,254,102,96,96,124,96,96,96,240,0,0},  /*  'F' 70 */
{0,124,198,198,192,192,206,198,198,124,0,0},  /*  'G' 71 */
{0,198,198,198,198,254,198,198,198,198,0,0},  /*  'H' 72 */
{0,60,24,24,24,24,24,24,24,60,0,0},  /*  'I' 73 */
{0,60,24,24,24,24,24,216,216,112,0,0},  /*  'J' 74 */
{0,198,204,216,240,240,216,204,198,198,0,0}, /* 'K' 75 */
{0,240,96,96,96,96,96,98,102,254,0,0},  /* 'L' 76 */
{0,198,198,238,254,214,214,214,198,198,0,0},  /*  'M' 77 */
{0,198,198,230,230,246,222,206,206,198,0,0},  /*  'N' 78 */
{0,124,198,198,198,198,198,198,198,124,0,0},  /*  'O' 79 */
{0,252,102,102,102,124,96,96,96,240,0,0},  /*  'P' 80 */
{0,124,198,198,198,198,198,198,214,124,6,0},  /*  'Q' 81 */
{0,252,102,102,102,124,120,108,102,230,0,0},  /*  'R' 82 */
{0,124,198,192,96,56,12,6,198,124,0,0},  /*  'S' 83 */
{0,126,90,24,24,24,24,24,24,60,0,0},  /*  'T' 84 */
{0,198,198,198,198,198,198,198,198,124,0,0},  /*  'U' 85 */
{0,198,198,198,198,198,198,108,56,16,0,0},  /*  'V' 86 */
{0,198,198,214,214,214,254,238,198,198,0,0},  /*  'W' 87 */
{0,198,198,108,56,56,56,108,198,198,0,0},  /*  'X' 88 */
{0,102,102,102,102,60,24,24,24,60,0,0},  /*  'Y' 89 */
{0,254,198,140,24,48,96,194,198,254,0,0},  /*  'Z' 90 */
{0,124,96,96,96,96,96,96,96,124,0,0},  /*  '[' 91 */
{0,0,128,192,96,48,24,12,6,2,0,0},  /*  '\' 92 */
{0,124,12,12,12,12,12,12,12,124,0,0},  /*  ']' 93 */
{16,56,108,198,0,0,0,0,0,0,0,0},  /*  '^' 94 */
{0,0,0,0,0,0,0,0,0,0,0,255},  /*  '_' 95 */
{24,24,24,12,0,0,0,0,0,0,0,0},  /*  '`' 96 */
{0,0,0,0,120,12,124,204,220,118,0,0},  /*  'a' 97 */
{0,224,96,96,124,102,102,102,102,252,0,0},  /*  'b' 98 */
{0,0,0,0,124,198,192,192,198,124,0,0},  /*  'c' 99 */
{0,28,12,12,124,204,204,204,204,126,0,0},  /*  'd' 100 */
{0,0,0,0,124,198,254,192,198,124,0,0},  /*  'e' 101 */
{0,28,54,48,48,252,48,48,48,120,0,0},  /*  'f' 102 */
{0,0,0,0,118,206,198,198,126,6,198,124},  /*  'g' 103 */
{0,224,96,96,108,118,102,102,102,230,0,0},  /*  'h' 104 */
{0,24,24,0,56,24,24,24,24,60,0,0},  /*  'i' 105 */
{0,12,12,0,28,12,12,12,12,204,204,120},  /*  'j' 106 */
{0,224,96,96,102,108,120,108,102,230,0,0},  /*  'k' 107 */
{0,56,24,24,24,24,24,24,24,60,0,0},  /*  'l' 108 */
{0,0,0,0,108,254,214,214,198,198,0,0},  /*  'm' 109 */
{0,0,0,0,220,102,102,102,102,102,0,0},  /*  'n' 110 */
{0,0,0,0,124,198,198,198,198,124,0,0},  /*  'o' 111 */
{0,0,0,0,220,102,102,102,124,96,96,240},  /*  'p' 112 */
{0,0,0,0,118,204,204,204,124,12,12,30},  /*  'q' 113 */
{0,0,0,0,220,102,96,96,96,240,0,0},  /*  'r' 114 */
{0,0,0,0,124,198,112,28,198,124,0,0},  /*  's' 115 */
{0,48,48,48,252,48,48,48,54,28,0,0},  /*  't' 116 */
{0,0,0,0,204,204,204,204,204,118,0,0},  /*  'u' 117 */
{0,0,0,0,198,198,198,108,56,16,0,0},  /*  'v' 118 */
{0,0,0,0,198,198,214,214,254,108,0,0},  /*  'w' 119 */
{0,0,0,0,198,108,56,56,108,198,0,0},  /*  'x' 120 */
{0,0,0,0,198,198,198,206,118,6,198,124},  /*  'y' 121 */
{0,0,0,0,254,140,24,48,98,254,0,0},  /*  'z' 122 */
{0,14,24,24,24,112,24,24,24,14,0,0},  /*  '{' 123 */
{0,24,24,24,24,0,24,24,24,24,0,0},  /*  '|' 124 */
{0,112,24,24,24,14,24,24,24,112,0,0},  /*  '}' 125 */
{0,118,220,0,0,0,0,0,0,0,0,0},  /*  '~' 126 */
{0,0,0,16,56,56,108,108,254,0,0,0},  /*  ' ' */
{0,60,102,192,192,192,198,102,60,24,204,56},  /*  '€' 128 */
{0,198,198,0,198,198,198,198,206,118,0,0},  /*  '�' 129 */
{12,24,48,0,124,198,254,192,198,124,0,0},  /*  '‚' 130 */
{48,120,204,0,120,12,124,204,220,118,0,0},  /*  'ƒ' 131 */
{0,204,204,0,120,12,124,204,220,118,0,0},  /*  '„' 132 */
{96,48,24,0,120,12,124,204,220,118,0,0},  /*  '…' 133 */
{56,108,56,0,120,12,124,204,220,118,0,0},  /*  '†' 134 */
{0,0,0,124,198,192,192,198,124,24,108,56},  /*  '‡' 135 */
{48,120,204,0,124,198,254,192,198,124,0,0},  /*  'ˆ' 136 */
{0,204,204,0,124,198,254,192,198,124,0,0},  /*  '‰' 137 */
{48,24,12,0,124,198,254,192,198,124,0,0},  /*  'Š' 138 */
{0,102,102,0,56,24,24,24,24,60,0,0},  /*  '‹' 139 */
{24,60,102,0,56,24,24,24,24,60,0,0},  /*  'Œ' 140 */
{96,48,24,0,56,24,24,24,24,60,0,0},  /*  ' ' */
{198,198,0,56,108,198,254,198,198,198,0,0},  /*  'Ž' 142 */
{56,108,56,0,56,108,198,198,254,198,198,0},  /*  '�' 143 */
{12,24,48,0,254,96,96,124,96,96,254,0},  /*  '�' 144 */
{0,0,0,102,219,27,127,216,223,118,0,0},  /*  '‘' 145 */
{126,216,216,216,216,254,216,216,216,222,0,0},  /*  '’' 146 */
{48,120,204,0,124,198,198,198,198,124,0,0},  /*  '“' 147 */
{0,198,198,0,124,198,198,198,198,124,0,0},  /*  '”' 148 */
{48,24,12,0,124,198,198,198,198,124,0,0},  /*  '•' 149 */
{48,120,204,0,198,198,198,198,206,118,0,0},  /*  '–' 150 */
{96,48,24,0,198,198,198,198,206,118,0,0},  /*  '—' 151 */
{0,198,198,0,198,198,198,206,118,6,198,124},  /*  '˜' 152 */
{198,198,0,124,198,198,198,198,198,124,0,0},  /*  '™' 153 */
{198,198,0,198,198,198,198,198,198,124,0,0},  /*  'š' 154 */
{24,24,60,102,96,96,102,60,24,24,0,0},  /*  '›' 155 */
{0,56,108,96,96,240,96,102,246,108,0,0},  /*  'œ' 156 */
{0,102,102,60,24,126,24,60,24,24,0,0},  /*  '�' 157 */
{252,198,252,192,204,222,204,204,204,198,0,0},  /*  'ž' 158 */
{14,27,24,24,24,126,24,24,24,24,216,112},  /*  'Ÿ' 159 */
{12,24,48,0,120,12,124,204,220,118,0,0},  /*  ' ' */
{12,24,48,0,56,24,24,24,24,60,0,0},  /*  '¡' 161 */
{12,24,48,0,124,198,198,198,198,124,0,0},  /*  '¢' 162 */
{24,48,96,0,204,204,204,204,220,118,0,0},  /*  '£' 163 */
{0,118,220,0,188,102,102,102,102,230,0,0},  /*  '¤' 164 */
{118,220,0,198,198,230,246,222,206,198,0,0},  /*  '¥' 165 */
{60,108,108,62,0,126,0,0,0,0,0,0},  /*  '¦' 166 */
{56,108,108,56,0,124,0,0,0,0,0,0},  /*  '§' 167 */
{0,48,48,0,48,48,96,198,198,124,0,0},  /*  '¨' 168 */
{0,0,0,0,0,126,96,96,96,0,0,0},  /*  '©' 169 */
{0,0,0,0,0,126,6,6,6,0,0,0},  /*  'ª' 170 */
{96,98,102,108,24,48,96,220,54,12,24,62},  /*  '«' 171 */
{96,98,102,108,24,54,110,222,54,126,6,6},  /*  '¬' 172 */
{0,24,24,0,24,24,60,60,60,24,0,0},  /*  ' 173 */
{0,0,0,54,108,216,108,54,0,0,0,0},  /*  '®' 174 */
{0,0,0,216,108,54,108,216,0,0,0,0},  /*  '¯' 175 */
{17,68,17,68,17,68,17,68,17,68,17,68},  /*  '°' 176 */
{85,170,85,170,85,170,85,170,85,170,85,170},  /*  '±' 177 */
{221,119,221,119,221,119,221,119,221,119,221,119},  /*  '²' 178 */
{24,24,24,24,24,24,24,24,24,24,24,24},  /*  '³' 179 */
{24,24,24,24,24,24,248,24,24,24,24,24},  /*  '´' 180 */
{24,24,24,24,248,24,248,24,24,24,24,24},  /*  'µ' 181 */
{54,54,54,54,54,54,246,54,54,54,54,54},  /*  '¶' 182 */
{0,0,0,0,0,0,254,54,54,54,54,54},  /*  '·' 183 */
{0,0,0,0,248,24,248,24,24,24,24,24},  /*  '¸' 184 */
{54,54,54,54,246,6,246,54,54,54,54,54},  /*  '¹' 185 */
{54,54,54,54,54,54,54,54,54,54,54,54},  /*  'º' 186 */
{0,0,0,0,254,6,246,54,54,54,54,54},  /*  '»' 187 */
{54,54,54,54,246,6,254,0,0,0,0,0},  /*  '¼' 188 */
{54,54,54,54,54,54,254,0,0,0,0,0},  /*  '½' 189 */
{24,24,24,24,248,24,248,0,0,0,0,0},  /*  '¾' 190 */
{0,0,0,0,0,0,248,24,24,24,24,24},  /*  '¿' 191 */
{24,24,24,24,24,24,31,0,0,0,0,0},  /*  'À' 192 */
{24,24,24,24,24,24,255,0,0,0,0,0},  /*  'Á' 193 */
{0,0,0,0,0,0,255,24,24,24,24,24},  /*  'Â' 194 */
{24,24,24,24,24,24,31,24,24,24,24,24},  /*  'Ã' 195 */
{0,0,0,0,0,0,255,0,0,0,0,0},  /*  'Ä' 196 */
{24,24,24,24,24,24,255,24,24,24,24,24},  /*  'Å' 197 */
{24,24,24,24,31,24,31,24,24,24,24,24},  /*  'Æ' 198 */
{54,54,54,54,54,54,55,54,54,54,54,54},  /*  'Ç' 199 */
{54,54,54,54,55,48,63,0,0,0,0,0},  /*  'È' 200 */
{0,0,0,0,63,48,55,54,54,54,54,54},  /*  'É' 201 */
{54,54,54,54,247,0,255,0,0,0,0,0},  /*  'Ê' 202 */
{0,0,0,0,255,0,247,54,54,54,54,54},  /*  'Ë' 203 */
{54,54,54,54,55,48,55,54,54,54,54,54},  /*  'Ì' 204 */
{0,0,0,0,255,0,255,0,0,0,0,0},  /*  'Í' 205 */
{54,54,54,54,247,0,247,54,54,54,54,54},  /*  'Î' 206 */
{24,24,24,24,255,0,255,0,0,0,0,0},  /*  'Ï' 207 */
{54,54,54,54,54,54,255,0,0,0,0,0},  /*  'Ð' 208 */
{0,0,0,0,255,0,255,24,24,24,24,24},  /*  'Ñ' 209 */
{0,0,0,0,0,0,255,54,54,54,54,54},  /*  'Ò' 210 */
{54,54,54,54,54,54,63,0,0,0,0,0},  /*  'Ó' 211 */
{24,24,24,24,31,24,31,0,0,0,0,0},  /*  'Ô' 212 */
{0,0,0,0,31,24,31,24,24,24,24,24},  /*  'Õ' 213 */
{0,0,0,0,0,0,63,54,54,54,54,54},  /*  'Ö' 214 */
{54,54,54,54,54,54,255,54,54,54,54,54},  /*  '×' 215 */
{24,24,24,24,255,24,255,24,24,24,24,24},  /*  'Ø' 216 */
{24,24,24,24,24,24,248,0,0,0,0,0},  /*  'Ù' 217 */
{0,0,0,0,0,0,31,24,24,24,24,24},  /*  'Ú' 218 */
{255,255,255,255,255,255,255,255,255,255,255,255},  /*  'Û' 219 */
{0,0,0,0,0,0,255,255,255,255,255,255},  /*  'Ü' 220 */
{240,240,240,240,240,240,240,240,240,240,240,240},  /*  'Ý' 221 */
{15,15,15,15,15,15,15,15,15,15,15,15},  /*  'Þ' 222 */
{255,255,255,255,255,255,0,0,0,0,0,0},  /*  'ß' 223 */
{0,0,0,118,220,216,216,216,220,118,0,0},  /*  'à' 224 */
{0,0,0,120,204,216,252,198,230,220,192,192},  /*  'á' 225 */
{0,254,102,98,96,96,96,96,96,96,0,0},  /*  'â' 226 */
{0,0,0,0,254,108,108,108,108,108,0,0},  /*  'ã' 227 */
{0,254,198,98,48,24,48,98,198,254,0,0},  /*  'ä' 228 */
{0,0,0,0,126,216,204,204,204,120,0,0},  /*  'å' 229 */
{0,0,0,102,102,102,102,124,96,192,128,0},  /*  'æ' 230 */
{0,0,0,0,118,220,24,24,24,24,0,0},  /*  'ç' 231 */
{0,254,56,108,198,198,198,108,56,254,0,0},  /*  'è' 232 */
{0,56,108,198,198,254,198,198,108,56,0,0},  /*  'é' 233 */
{0,56,108,198,198,198,108,108,108,238,0,0},  /*  'ê' 234 */
{0,62,96,48,60,102,198,198,204,120,0,0},  /*  'ë' 235 */
{0,0,0,0,126,219,219,126,0,0,0,0},  /*  'ì' 236 */
{0,6,12,124,222,246,230,124,96,192,0,0},  /*  'í' 237 */
{0,28,48,96,96,124,96,96,48,28,0,0},  /*  'î' 238 */
{0,124,198,198,198,198,198,198,198,198,0,0},  /*  'ï' 239 */
{0,0,0,0,254,0,254,0,254,0,0,0},  /*  'ð' 240 */
{0,0,0,24,24,126,24,24,0,126,0,0},  /*  'ñ' 241 */
{0,48,24,12,6,12,24,48,0,126,0,0},  /*  'ò' 242 */
{0,12,24,48,96,48,24,12,0,126,0,0},  /*  'ó' 243 */
{0,0,12,30,26,24,24,24,24,24,24,24},  /*  'ô' 244 */
{24,24,24,24,24,24,24,24,88,120,48,0},  /*  'õ' 245 */
{0,0,24,24,0,126,0,24,24,0,0,0},  /*  'ö' 246 */
{0,0,0,0,118,220,0,118,220,0,0,0},  /*  '÷' 247 */
{0,120,204,204,120,0,0,0,0,0,0,0},  /*  'ø' 248 */
{0,0,0,0,0,24,24,0,0,0,0,0},  /*  'ù' 249 */
{0,0,0,0,0,0,24,0,0,0,0,0},  /*  'ú' 250 */
{0,0,31,24,24,24,24,216,120,56,24,0},  /*  'û' 251 */
{216,108,108,108,108,0,0,0,0,0,0,0},  /*  'ü' 252 */
{112,216,48,96,248,0,0,0,0,0,0,0},  /*  'ý' 253 */
{0,0,0,126,126,126,126,126,126,0,0,0},  /*  'þ' 254 */
{0,0,0,0,0,0,0,0,0,0,0,0},  /*  'ÿ' 255 */
};

void drawChar(void *buffer,uint8_t character,int color,int x,int y)
{
  int i, j, pixelOn;
  for(i=0;i<CHAR_HEIGHT;i++)
  {
    for(j=0;j<CHAR_WIDTH;j++)
    {
      pixelOn=charMap_ascii[character][i]<<j;
      pixelOn=pixelOn & 0x80;
      if(pixelOn)
        securedBufSetPixel(buffer,x+j,y+i,color);
    }
  }
}


void drawStringCenter(void *buffer,char *str,int color,int y)
{
  int i,length,x;
  length=strlen(str);
  x=(SCREEN_GAME_WIDTH-length*CHAR_WIDTH-length)/2;
  for(i=0;i<length;i++)
  {
    drawChar(buffer,str[i],color,x+i*CHAR_WIDTH+i,y);
  }
}



void drawString(void *buffer,char *str,int color,int x,int y)
{
  int i,length;
  length=strlen(str);
  for(i=0;i<length;i++)
  {
    drawChar(buffer,str[i],color,x+i*CHAR_WIDTH+i,y);
  }
}


void drawCursor(void *buffer)
{
  int i;
  int color=0xF;
  #ifdef _16BPP
    color=0xFFFF;
  #endif
  for(i=0;i<=19;i++)
  {
    bufSetPixel(buffer,i+(SCREEN_GAME_WIDTH)/2-11,(SCREEN_GAME_HEIGHT)/2-2,color);
    bufSetPixel(buffer,i+(SCREEN_GAME_WIDTH)/2-11,(SCREEN_GAME_HEIGHT)/2-1,color);
    bufSetPixel(buffer,(SCREEN_GAME_WIDTH)/2-2,i+(SCREEN_GAME_HEIGHT)/2-11,color);
    bufSetPixel(buffer,(SCREEN_GAME_WIDTH)/2-1,i+(SCREEN_GAME_HEIGHT)/2-11,color);
  }
}

void drawCubeIndicator(void *buffer,int color)
{
  drawTriangle(buffer,color,SCREEN_GAME_WIDTH-19,0,SCREEN_GAME_WIDTH-1,0,SCREEN_GAME_WIDTH-1,9);
}

void drawProgressBar(void *buffer,int percent)
{
  int i=0;
  
  #ifdef _16BPP
  int color= 0xFFFF;
  #else
  int color = 0xF;
  #endif
  
  for(i=230;i<239;i++)
  {
    bufHorizLine(buffer,0,i,SCREEN_GAME_WIDTH-1,0);
  }
  for(i=231;i<238;i++)
  {
    bufHorizLine(buffer,1,i,1+percent*317/100,color);
  }
}

void drawCube(void *buffer,float *vertices,int *pos,int *faces,int *colors)
{
  if(isCubeOnScreen(pos))
  {
    int i=0,j=0;
    int a=0,b=0,c=0,d=0;
    float e=0.0f,f=0.0f,g=0.0f;
    float dist[6]={0.0f};
    
    int facesImg[6*4]={0};
    int colorsImg[6]={0};
    
    memcpy(facesImg,faces,24*sizeof(int));
    memcpy(colorsImg,colors,6*sizeof(int));
    
    for(i=0;i<6;i++)
    {
      e=vertices[faces[i*4]*3-3]/2.0f+vertices[faces[i*4+2]*3-3]/2.0f;
      f=vertices[faces[i*4]*3-2]/2.0f+vertices[faces[i*4+2]*3-2]/2.0f;
      g=vertices[faces[i*4]*3-1]/2.0f+vertices[faces[i*4+2]*3-1]/2.0f;
      dist[i]=e*e+f*f+g*g;
    }
    
    for(i=0;i<5;i++)
    {
      for(j=0;j<5-i;j++)
      {
        if(dist[j]>dist[j+1])
        {
          e=dist[j];
          dist[j]=dist[j+1];
          dist[j+1]=e;
          invertTableElems(facesImg,4*j,4*j+4);
          invertTableElems(facesImg,4*j+1,4*j+5);
          invertTableElems(facesImg,4*j+2,4*j+6);
          invertTableElems(facesImg,4*j+3,4*j+7);
          invertTableElems(colorsImg,j,j+1);
        }
      }
    }
    
    i=2;
    while(i>=0)
    {
      a=facesImg[i*4]-1;
      b=facesImg[i*4+1]-1;
      c=facesImg[i*4+2]-1;
      d=facesImg[i*4+3]-1;
      drawTriangle(buffer,colorsImg[i],pos[a*2],pos[a*2+1],pos[b*2],pos[b*2+1],pos[c*2],pos[c*2+1]);
      drawTriangle(buffer,colorsImg[i],pos[d*2],pos[d*2+1],pos[a*2],pos[a*2+1],pos[c*2],pos[c*2+1]);
      i--;
    }
  }
}



int isCubeOnScreen(int *pos)
{
  int test=1;
  if(pos[0]<0 && pos[2]<0 && pos[4]<0 && pos[6]<0 && pos[8]<0 && pos[10]<0 && pos[12]<0 && pos[14]<0)
  {
    test=0;
  }
  else if(pos[1]<0 && pos[3]<0 && pos[5]<0 && pos[7]<0 && pos[9]<0 && pos[11]<0 && pos[13]<0 && pos[15]<0)
  {
    test=0;
  }
  else if(pos[0]>319 && pos[2]>319 && pos[4]>319 && pos[6]>319 && pos[8]>319 && pos[10]>319 && pos[12]>319 && pos[14]>319)
  {
    test=0;
  }
  else if(pos[1]>239 && pos[3]>239 && pos[5]>239 && pos[7]>239 && pos[9]>239 && pos[11]>239 && pos[13]>239 && pos[15]>239)
  {
    test=0;
  }
  return test;
}



void drawTriangle(void *buffer,int color,int x1,int y1,int x2,int y2,int x3,int y3)
{
#if 0
  int i=0;
  int start=1;
  if(y1>y2)
  {
    invertVars(&y1,&y2);
    invertVars(&x1,&x2);
  }
  if(y1>y3)
  {
    invertVars(&y1,&y3);
    invertVars(&x1,&x3);
  }
  if(y2>y3)
  {
    invertVars(&y2,&y3);
    invertVars(&x2,&x3);
  }
  if(y2>0)
  {
    start=0;
    if(y1<0)
      start=-y1;
    for(i=start;i<=y2-y1;i++)
    {
      bufHorizLine(buffer,x1+(x2-x1)*i/(y2-y1),y1+i,x1+(x3-x1)*i/(y3-y1),color);
    }
  }
  if(y3>0)
  {
    start=0;
    if(y2<0)
      start=-y2;
    for(i=start;i<=y3-y2;i++)
    {
      bufHorizLine(buffer,x2+(x3-x2)*i/(y3-y2),y2+i,x1+(x3-x1)*(y2-y1+i)/(y3-y1),color);
    }
  }
#else
  int i=0;
  int start=1;
  unsigned int calc[3];
  int tmp;
  if(y1>y2)
  {
    invertVars(&y1,&y2);
    invertVars(&x1,&x2);
  }
  if(y1>y3)
  {
    invertVars(&y1,&y3);
    invertVars(&x1,&x3);
  }
  if(y2>y3)
  {
    invertVars(&y2,&y3);
    invertVars(&x2,&x3);
  }
  if(y2>0)
  {
    start=0;
    if(y1<0)
      start=-y1;
    for(i=start;i<=y2-y1;i++)
    {
		tmp = (y2-y1);
		if (tmp > SCREEN_GAME_WIDTH) tmp = SCREEN_GAME_WIDTH;
		else if (tmp < 1) tmp = 1;
		calc[0] = x1+(x2-x1)*i/tmp;
		calc[1] = y1+i;
		tmp = (y3-y1);
		if (tmp > SCREEN_GAME_WIDTH) tmp = SCREEN_GAME_WIDTH;
		else if (tmp < 1) tmp = 1;
		calc[2] = x1+(x3-x1)*i/tmp;
		bufHorizLine(buffer,calc[0],calc[1],calc[2],color);
    }
  }
  if(y3>0)
  {
    start=0;
    if(y2<0)
      start=-y2;
    for(i=start;i<=y3-y2;i++)
    {
		tmp = (y3-y2);
		if (tmp > SCREEN_GAME_WIDTH) tmp = SCREEN_GAME_WIDTH;
		else if (tmp < 1) tmp = 1;
		calc[0] = x2+(x3-x2)*i/tmp;
		calc[1] = y2+i;
		tmp = (y3-y1);
		if (tmp > SCREEN_GAME_WIDTH) tmp = SCREEN_GAME_WIDTH;
		else if (tmp < 1) tmp = 1;
		calc[2] = x1+(x3-x1)*(y2-y1+i)/tmp;
		
		bufHorizLine(buffer,calc[0],calc[1],calc[2],color);
    }
  }
#endif
}

